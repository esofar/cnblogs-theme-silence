"use strict";
var _createClass = function () {
    function s(a, t) {
        for (var e = 0; e < t.length; e++) {
            var s = t[e];
            s.enumerable = s.enumerable || !1, s.configurable = !0, "value" in s && (s.writable = !0), Object.defineProperty(a, s.key, s)
        }
    }

    return function (a, t, e) {
        return t && s(a.prototype, t), e && s(a, e), a
    }
}();

function _classCallCheck(a, t) {
    if (!(a instanceof t)) throw new TypeError("Cannot call a class as a function")
}

!function (h) {
    h.extend({
        silence: function (a) {
            var t = new s;
            t.init(a)
        }
    });
    var t = {
        css: "https://unpkg.com/lightbox2@2.11.1/dist/css/lightbox.min.css",
        js: "https://unpkg.com/lightbox2@2.11.1/dist/js/lightbox.min.js"
    }, e = {js: "https://unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"}, s = (_createClass(a, [{
        key: "init", value: function (a) {
            a && h.extend(!0, this.defaluts, a), this.buildCustomNavigation(), this.buildGithubCorner(), this.buildCopyright(), this.buildBloggerProfile(), this.isPostPage ? (this.buildPostCatalog(), this.buildPostCodeCopyBtns(), this.buildPostLightbox(), this.buildPostSignature(), this.buildPostSponsor(), this.buildToolbar(), this.buildPostCommentAvatars()) : this.showSideBar()
        }
    }, {
        key: "showMessage", value: function (a) {
            h("body").prepend('<div class="esa-layer"><span class="esa-layer-content">' + a + "</span></div>");
            var t = h(".esa-layer");
            t.fadeIn(200), setTimeout(function () {
                t.remove()
            }, 2e3)
        }
    }, {
        key: "showSideBar", value: function () {
            767 < h(window).width() && (h(this.cnblogs.forFlow).css({marginLeft: "22em"}), h(this.cnblogs.sideBar).fadeIn(600))
        }
    }, {
        key: "buildCustomNavigation", value: function () {
            var a = this, s = h(this.cnblogs.navList), n = h("body").css("color"), t = this.defaluts.navigation;
            if (t && t.length) {
                h.each(t.reverse(), function (a, t) {
                    if (t.chilren && t.chilren.length) {
                        var e = t.chilren.map(function (a) {
                            return '<li><a class="menu" href="' + a.url + '">' + a.title + "</a></li>"
                        });
                        s.find("li").eq(1).after('\n                            <li class="esa-has-subnavs">\n                                <a class="menu" href="javascript:void(0);">' + t.title + '\n                                    <svg class="arrow" width="12px" height="8px" viewBox="0 0 14 8" xml:space="preserve" fill="none" stroke="' + n + '"><path d="M1,1l6.2,6L13,1"></path></svg>\n                                </a>\n                                <ul class="esa-sub-navs">' + e.join("") + "</ul>\n                            </li>")
                    } else s.find("li").eq(1).after('<li><a class="menu" href="' + t.url + '">' + t.title + "</a></li>")
                });
                var e = !1;
                h(".esa-has-subnavs").on("click", function () {
                    h(".esa-sub-navs").hide(), h(".arrow").removeClass("open"), e = !e && (h(this).find("svg").addClass("open"), h(this).find("ul").show(), !0)
                })
            }
            h.each(s.children("li"), function (a, t) {
                h(t).append("<i></i>")
            }), h("body").prepend('<div class="esa-mobile-menu"></div>'), h(".esa-mobile-menu").on("click", function () {
                h(a.cnblogs.navigator).fadeToggle(200)
            }), h(this.cnblogs.header).append('\n                <div class="esa-search-box">\n                    <div class="div_my_zzk">\n                        <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk" placeholder="Type to Search">&nbsp;<input onclick="zzk_go()" type="button" value="搜 索" id="btnZzk" class="btn_my_zzk">\n                    </div>\n                </div>'), h(this.cnblogs.navigator).append('\n                <svg t="1573264861612" class="icon esa-search-btn" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7386" width="32" height="32" data-spm-anchor-id="a313x.7781069.0.i8">\n                    <path fill="' + n + '" d="M616.362667 580.608h-23.808l-8.533334-8.128a196.16 196.16 0 1 0-21.098666 21.098667l8.128 8.533333v23.808l150.805333 150.165333 44.8-44.8z m-180.8 0a135.594667 135.594667 0 1 1 135.594666-135.594667 135.402667 135.402667 0 0 1-135.573333 135.594667z" p-id="7387"></path>\n                </svg>'), h(this.cnblogs.navigator).append('\n                <svg t="1573265135257" class="icon esa-search-close" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15367" width="32" height="32">\n                    <path fill="' + n + '" d="M515.23600182 491.06853843L378.27564815 354.10818478a17.09155825 17.09155825 0 1 0-24.17885764 24.15606913l136.96035332 136.97174792-136.96035331 136.97174789a17.09155825 17.09155825 0 1 0 24.16746339 24.16746337l136.97174791-136.96035366 136.9717479 136.96035366a17.09155825 17.09155825 0 1 0 24.16746337-24.15606912l-136.96035366-136.98314215 136.96035366-136.96035367a17.09155825 17.09155825 0 1 0-24.16746337-24.16746337l-136.96035366 136.96035364z" p-id="15368"></path>\n                </svg>');
            var o = h(".esa-search-box"), i = h(".esa-search-btn"), l = h(".esa-search-close");
            i.on("click", function () {
                o.slideDown("fast"), l.show(), i.hide()
            }), l.on("click", function () {
                o.slideUp("fast"), l.hide(), i.show()
            })
        }
    }, {
        key: "buildCopyright", value: function () {
            var a = '<span class="esa-copyright">& Theme <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank">Silence v' + this.version + "</a></span>";
            h(this.cnblogs.footer).append(a)
        }
    }, {
        key: "buildPostSignature", value: function () {
            var a = this.defaluts.signature;
            if (a.enable) {
                var t = h(this.cnblogs.postTitle).attr("href"),
                    e = '<div class="esa-post-signature"> \n                        <p>作者：' + (a.author || h(this.cnblogs.publicProfile).find("a:eq(0)").html()) + '</p> \n                        <p>出处：<a href="' + t + '">' + t + '</a></p> \n                        <p>版权：本文采用「<a href="' + a.link + '"  target="_blank">' + a.license + "</a>」知识共享许可协议进行许可。</p> \n                        <p>" + (a.remark || "") + "</p> \n                    </div>";
                h(this.cnblogs.postSignature).html(e).show()
            }
        }
    }, {
        key: "buildPostCommentAvatars", value: function () {
            function a() {
                // Quaint 修改 --> 判断评论是否加载完成
                var quaint_text = $("#blog-comments-placeholder").text();
                if (quaint_text == "努力加载评论中...") {
                    // quaint 增加 代码
                    var quaint_h = {postId: cb_entryId, pageIndex: 0, anchorCommentId: 0};

                    $.ajax({
                        url: getAjaxBaseUrl() + "GetCommentCount.aspx",
                        data: {postId: quaint_h.postId},
                        type: "get",
                        dataType: "text",
                        cache: !1,
                        success: function (i) {
                            i ? ($("#post_comment_count").html(i), $.ajax({
                                url: getAjaxBaseUrl() + "GetComments.aspx",
                                data: quaint_h,
                                type: "get",
                                dataType: "text",
                                cache: !1,
                                success: function (i) {
                                    $("#blog-comments-placeholder").html(i);
                                    $("#comment_form_container").css("visibility", "visible");

                                    // Quaint 修改 --> 如果加载完成，则 填充头像。
                                    h(o.cnblogs.postCommentBody).before("<div class='esa-comment-avatar'><a target='_blank'><img /></a></div>");
                                    for (var a = h(o.cnblogs.feedbackContent), t = 0; t < a.length; t++) {
                                        var e = "https://pic.cnblogs.com/face/sample_face.gif", s = h(a[t]).find("span:last")[0];
                                        s && (e = h(s).html().replace("http://", "//")), h(a[t]).find(".esa-comment-avatar img").attr("src", e);
                                        var n = h(a[t]).parent().find(".comment_date").next().attr("href");
                                        h(a[t]).find(".esa-comment-avatar a").attr("href", n)
                                    }

                                }
                            })) : ($("#comment_form_container").css("visibility", "visible"), cb_CodeHighlight(), $("#blog-comments-placeholder").html(""))
                        }
                    });
                } else {
                    // Quaint 修改 --> 如果加载完成，则 填充头像。
                    h(o.cnblogs.postCommentBody).before("<div class='esa-comment-avatar'><a target='_blank'><img /></a></div>");
                    for (var a = h(o.cnblogs.feedbackContent), t = 0; t < a.length; t++) {
                        var e = "https://pic.cnblogs.com/face/sample_face.gif", s = h(a[t]).find("span:last")[0];
                        s && (e = h(s).html().replace("http://", "//")), h(a[t]).find(".esa-comment-avatar img").attr("src", e);
                        var n = h(a[t]).parent().find(".comment_date").next().attr("href");
                        h(a[t]).find(".esa-comment-avatar a").attr("href", n)
                    }
                }
            }

            var o = this;
            if (h(this.cnblogs.postCommentBody).length) a(); else var t = 1, e = setInterval(function () {
                h(o.cnblogs.postCommentBody).length && (clearInterval(e), a()), 10 == t && clearInterval(e), t++
            }, 500)
        }
    }, {
        key: "buildPostSponsor", value: function () {
            var t = this.defaluts.sponsor, a = this.defaluts.github, e = this;
            if (t.enable) {
                h("#blog_post_info").prepend('\n                <div class="esa-sponsor">\n                    <a class="github" href="' + (a.enable ? a.link : "https://github.com/Kaiyuan/donate-page") + '" target="_blank" class="posa tr3" title="Github"></a>\n                    <div class="text tr3">' + (t.text || "Sponsor") + '</div>\n                    <ul class="box posa tr3">\n                        <li class="paypal">PayPal</li>\n                        <li class="alipay">AliPay</li>\n                        <li class="wechat">WeChat</li>\n                    </ul>\n                    <div id="QRBox" class="posa left-100">\n                        <div id="MainBox"></div>\n                    </div>\n                </div>');
                var s = h(".esa-sponsor"), n = h("#QRBox"), o = h("#MainBox");
                s.find(".box>li").click(function () {
                    var a = h(this).attr("class");
                    if ("paypal" === a) {
                        if (!t.paypal) return e.showMessage("博主忘记设置 PayPal 收款地址");
                        window.open(t.paypal, "_blank")
                    } else if ("alipay" === a) {
                        if (!t.alipay) return e.showMessage("博主忘记设置支付宝收款二维码");
                        i(t.alipay)
                    } else if ("wechat" === a) {
                        if (!t.wechat) return e.showMessage("博主忘记设置微信收款二维码");
                        i(t.wechat)
                    }
                }), o.click(function () {
                    o.removeClass("showQR").addClass("hideQR"), setTimeout(function (a) {
                        n.fadeOut(300, function () {
                            o.removeClass("hideQR")
                        }), s.find(".text, .box, .github").removeClass("blur")
                    }, 600)
                })
            }

            function i(a) {
                a && o.css("background-image", "url(" + a + ")"), s.find(".text, .box, .github").addClass("blur"), n.fadeIn(300, function () {
                    o.addClass("showQR")
                })
            }
        }
    }, {
        key: "buildPostCatalog", value: function () {
            var l = this.defaluts.catalog;
            if (l.enable) {
                var a = [l.level1, l.level2, l.level3], t = h(this.cnblogs.postBody).find(a.join(","));
                if (!t.length) return !1;
                var e = h('<div class="esa-catalog">\n                        <div class="esa-catalog-contents">\n                            <div class="esa-catalog-title">CONTENTS</div>\n                            <a class="esa-catalog-close">✕</a>\n                        </div>\n                    </div>'),
                    r = 0, c = 0, d = 0, p = "<ul>",
                    u = (window.crypto || window.msCrypto).getRandomValues(new Uint32Array(t.length));
                h.each(t, function (a, t) {
                    var e = h(t)[0].tagName.toLowerCase(), s = h(t).text(), n = "", o = s;
                    if (l.index) e === l.level1 ? (d = c = 0, n = '<span class="level1">' + ++r + ". </span>") : e === l.level2 ? (d = 0, n = '<span class="level2">' + r + "." + ++c + ". </span>") : e === l.level3 && (n = '<span class="level3">' + r + "." + c + "." + ++d + ". </span>"); else switch (e) {
                        case l.level1:
                            o = '<span class="level1">' + o + "</span>";
                            break;
                        case l.level2:
                            o = '<span class="level2">' + o + "</span>";
                            break;
                        case l.level3:
                            o = '<span class="level3">' + o + "</span>"
                    }
                    var i = u[a];
                    p += '<li class="li_' + e + '" title="' + s + '">\n                            <i class="' + i + '" ></i><a class="esa-anchor-link">' + (n + o) + "</a>\n                        </li>", h(t).attr("id", "" + i).append('<a href="#' + i + '" class="esa-anchor">#</a>').hover(function () {
                        h(t).find(".esa-anchor").css("opacity", 1)
                    }, function () {
                        h(t).find(".esa-anchor").css("opacity", 0)
                    })
                }), p += "</ul>", e.find(".esa-catalog-contents").append(p), e.appendTo("body");
                var s = h(".esa-catalog-contents");
                if (s.fadeIn(), h(".esa-anchor-link").on("click", function () {
                    var a = h("#" + h(this).prev("i").attr("class")).offset().top;
                    h("html, body").animate({scrollTop: a - 70}, 300)
                }), h(".esa-catalog-close").on("click", function () {
                    s.hide()
                }), l.move) {
                    var i = {start: !1, pois: [0, 0]};
                    h(".esa-catalog-title").on("mousedown", function (a) {
                        a.preventDefault(), i.start = !0;
                        var t = h(".esa-catalog").position(), e = a.clientX - parseFloat(t.left),
                            s = a.clientY - parseFloat(t.top);
                        i.pois = [e, s]
                    }), h(document).on("mousemove", function (a) {
                        if (i.start) {
                            var t = a.clientX - i.pois[0], e = a.clientY - i.pois[1],
                                s = "fixed" === h(".esa-catalog").css("position");
                            a.preventDefault(), i.stX = s ? 0 : h(window).scrollLeft(), i.stY = s ? 0 : h(window).scrollTop();
                            var n = h(window).width() - h(".esa-catalog").outerWidth() + i.stX,
                                o = h(window).height() - h(".esa-catalog").outerHeight() + i.stY;
                            t < i.stX && (t = i.stX), n < t && (t = n), e < i.stY && (e = i.stY), o < e && (e = o), h(".esa-catalog").css({
                                left: t,
                                top: e,
                                right: "auto"
                            })
                        }
                    }).on("mouseup", function (a) {
                        i.start && (i.start = !1)
                    })
                }
            }
        }
    }, {
        key: "buildGithubCorner", value: function () {
            var a = this.defaluts.github;
            if (a.enable) {
                var t = a.fill ? "fill:" + a.fill + ";" : "";
                h("body").append('<a href="' + a.link + '" class="github-corner" title="Fork me on GitHub" target="' + a.target + '">\n                        <svg width="60" height="60" viewBox="0 0 250 250" style="' + t + " color:" + a.color + '; z-index: 999; position: fixed; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true">\n                            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>\n                            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>\n                            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>\n                        </svg>\n                    </a>')
            }
        }
    }, {
        key: "buildPostCodeCopyBtns", value: function () {
            var t = this, a = h(".postBody .cnblogs-markdown").find("pre");
            if (!a.length) return !1;
            h.each(a, function (a, t) {
                h(t).find("code").attr("id", "copy_target_" + a), h(t).prepend('<div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_' + a + '">Copy</div>')
            }), h.getScript(e.js, function () {
                var a = new ClipboardJS(".esa-clipboard-button");
                a.on("success", function (a) {
                    t.showMessage("代码已复制"), a.clearSelection()
                }), a.on("error", function (a) {
                    t.showMessage("代码复制失败")
                })
            })
        }
    }, {
        key: "buildToolbar", value: function () {
            var e = this, a = this.defaluts.catalog;
            h("body").append('<div class="esa-toolbar">\n                <button class="esa-toolbar-gotop" data-tips="返回顶部"></button>\n                <button class="esa-toolbar-contents" data-tips="阅读目录"></button>\n                <button class="esa-toolbar-follow" data-tips="关注博主"></button>\n            </div>');
            var t = h(".esa-toolbar-gotop"), s = h(".esa-toolbar-contents"), n = h(".esa-toolbar-follow");
            a.enable ? s.on("click", function () {
                var a = h(".esa-catalog-contents");
                "none" == a.css("display") ? a.fadeIn() : a.hide()
            }) : s.remove(), t.on("click", function () {
                h(window).scrollTop(0)
            }), h(window).scroll(function () {
                200 < this.scrollY ? t.fadeIn() : t.fadeOut()
            }), n.on("click", function () {
                loadLink(location.protocol + "//common.cnblogs.com/scripts/artDialog/ui-dialog.css", function () {
                    loadScript(location.protocol + "//common.cnblogs.com/scripts/artDialog/dialog-min.js", function () {
                        if (!isLogined) return login();
                        if (c_has_follwed) return e.showMessage("您已经关注过该博主啦");
                        var t = cb_blogUserGuid;
                        h.ajax({
                            url: getAjaxBaseUrl() + "Follow/FollowBlogger.aspx",
                            data: '{"blogUserGuid":"' + t + '"}',
                            dataType: "text",
                            type: "post",
                            contentType: "application/json; charset=utf-8",
                            success: function (a) {
                                "未登录" == a ? login() : "关注成功，请选择分组" == a && followByGroup(t, !0), e.showMessage(a)
                            }
                        })
                    })
                })
            })
        }
    }, {
        key: "buildBloggerProfile", value: function () {
            var a = this.defaluts.avatar, t = this.defaluts.favicon;
            !this.isPostPage && a && h(this.cnblogs.sideBarMain).prepend('<img class="esa-profile-avatar" src="' + a + '" />'), t && h("head").append('<link rel="shortcut icon" href="' + t + '" type="image/x-icon" />')
        }
    }, {
        key: "buildPostLightbox", value: function () {
            var a = this;
            h("head").append('<link rel="stylesheet" href="' + t.css + '"/>'), h.getScript(t.js, function () {
                h(a.cnblogs.postBody).find("img").wrap(function () {
                    return '<a href="' + h(this).attr("src") + '" data-title="' + (h(this).attr("title") || "") + '" data-alt="' + (h(this).attr("alt") || "") + '" data-lightbox="roadtrip"></a>'
                }), h(".code_img_closed, .code_img_opened, .cnblogs_code_copy img").unwrap()
            })
        }
    }, {
        key: "cnblogs", get: function () {
            return {
                header: "#header",
                blogTitle: "#blogTitle",
                publicProfile: "#profile_block",
                navigator: "#navigator",
                navList: "#navList",
                sideBar: "#sideBar",
                sideBarMain: "#sideBarMain",
                forFlow: ".forFlow",
                postTitle: "#cb_post_title_url",
                postDetail: "#post_detail",
                postBody: "#cnblogs_post_body",
                postDigg: "#div_digg",
                postCommentBody: ".blog_comment_body",
                feedbackContent: ".feedbackCon",
                postSignature: "#MySignature",
                footer: "#footer"
            }
        }
    }, {
        key: "isPostPage", get: function () {
            return 0 < h(this.cnblogs.postDetail).length
        }
    }]), a);

    function a() {
        _classCallCheck(this, a), this.defaluts = {
            avatar: null,
            favicon: null,
            navigation: [],
            catalog: {enable: !1, move: !0, index: !0, level1: "h2", level2: "h3", level3: "h4"},
            signature: {
                enable: !0,
                author: null,
                license: "署名-非商业性使用-相同方式共享 4.0 国际",
                link: "https://creativecommons.org/licenses/by-nc-sa/4.0/",
                remark: null
            },
            sponsor: {enable: !1, text: null, paypal: null, wechat: null, alipay: null},
            github: {enable: !1, color: "#fff", fill: null, link: null, target: "_self"}
        }, this.version = "2.0.2"
    }
}(jQuery);